<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/senko/polyfill/Polyfill.js | senkowsh</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="JScirpt library for WSH that gathers various functions."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="senkowsh"><meta property="twitter:description" content="JScirpt library for WSH that gathers various functions."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/natade-jp/SenkoWSH"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SenkoWSH">SenkoWSH</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#konpeito">konpeito</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/konpeito/Random.js~Random.html">Random</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#mojijs">mojijs</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mojijs/Japanese.js~Japanese.html">Japanese</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mojijs/StringComparator.js~StringComparator.html">StringComparator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#senko">senko</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/CSV.js~CSV.html">CSV</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/Dialog.js~Dialog.html">Dialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/Format.js~Format.html">Format</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/Robot.js~Robot.html">Robot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/SFile.js~SFile.html">SFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/System.js~System.html">System</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OpenDirectoryOption">OpenDirectoryOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OpenFileOption">OpenFileOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-PopupOption">PopupOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SaveAsOption">SaveAsOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-typePopupMessageButton">typePopupMessageButton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-typePopupMessageDefaultButton">typePopupMessageDefaultButton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-typePopupMessageIcon">typePopupMessageIcon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-typePopupMessageOption">typePopupMessageOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-typePopupMessageReturn">typePopupMessageReturn</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-KeyEventOption">KeyEventOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MouseEventFCodes">MouseEventFCodes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MouseEventOption">MouseEventOption</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RobotGetHandleData">RobotGetHandleData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-VirtualKeyCode">VirtualKeyCode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-VirtualKeyCodes">VirtualKeyCodes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WSHRobotPosition">WSHRobotPosition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WSHRobotRect">WSHRobotRect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SystemExecResult">SystemExecResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-typeAppWinStyle">typeAppWinStyle</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#senko-polyfill">senko/polyfill</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/polyfill/ExtendsArray.js~ExtendsArray.html">ExtendsArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/senko/polyfill/ExtendsString.js~ExtendsString.html">ExtendsString</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/senko/polyfill/Polyfill.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * The script is part of SenkoWSH.
 * 
 * AUTHOR:
 *  natade (http://twitter.com/natadea)
 * 
 * LICENSE:
 *  The MIT license https://opensource.org/licenses/MIT
 */

import typeExtendsArray from &quot;./ExtendsArray.js&quot;;
import typeExtendsString from &quot;./ExtendsString.js&quot;;

/**
 * &#x30B0;&#x30ED;&#x30FC;&#x30D0;&#x30EB;&#x7A7A;&#x9593;
 * &#x53C2;&#x8003;
 *  JavaScript&#x5927;&#x57DF;&#x5909;&#x6570;&#x306E;&#x5B58;&#x5728;&#x78BA;&#x8A8D;
 *  https://m-hiyama.hatenablog.com/entry/20071126/1196037633
 * @private
 */
var global_var = ( function() { return this; } ).apply( null, [] );

if(!(&quot;globalThis&quot; in global_var)) {
	// @ts-ignore
	globalThis = global_var;
}
if(!(&quot;global&quot; in globalThis)) {
	// @ts-ignore
	global = globalThis;
}
if(!(&quot;window&quot; in globalThis)) {
	// @ts-ignore
	window = globalThis;
}
if(!(&quot;JSON&quot; in globalThis)) {
	// @ts-ignore
	JSON = {};
}

/**
 * @type {typeof typeExtendsArray}
 * @private
 */
// @ts-ignore
// eslint-disable-next-line no-undef
ExtendsArray = typeExtendsArray;

/**
 * @type {typeof typeExtendsString}
 * @private
 */
// @ts-ignore
// eslint-disable-next-line no-undef
ExtendsString = typeExtendsString;

/**
 * @param {any} original 
 * @param {any} extension
 * @returns {any}
 * @private
 * @ignore
 */
const extendClass = function(original, extension) {
	for(const key in extension) {
		// &#x672A;&#x8A2D;&#x5B9A;&#x306A;&#x3089;&#x8A2D;&#x5B9A;&#x3059;&#x308B;
		if(!original.prototype[key]) {
			original.prototype[key] = function() {
				const x = [];
				x.push(this);
				for(let i = 0 ; i &lt; arguments.length ; i++) {
					x.push(arguments[i]);
				}
				return extension[key].apply(this, x);
			};
		}
	}
};

extendClass(Array, typeExtendsArray);
extendClass(String, typeExtendsString);

/**
 * Class for improving compatibility.
 * @ignore
 */
export default class Polyfill {

	/**
	 * Improved compatibility
	 * @private
	 * @ignore
	 */
	static run() {
		if(!Math.imul) {
			Math.imul = function(x1, x2) {
				let y = ((x1 &amp; 0xFFFF) * (x2 &amp; 0xFFFF)) &gt;&gt;&gt; 0;
				let b = (x1 &amp; 0xFFFF) * (x2 &gt;&gt;&gt; 16);
				y = (y + ((b &amp; 0xFFFF) &lt;&lt; 16)) &gt;&gt;&gt; 0;
				b = (x1 &gt;&gt;&gt; 16) * (x2 &amp; 0xFFFF);
				y = (y + ((b &amp; 0xFFFF) &lt;&lt; 16));
				return (y &amp; 0xFFFFFFFF);
			};
		}
		if(!Math.trunc) {
			Math.trunc = function(x) {
				return x &gt; 0 ? Math.floor(x) : Math.ceil(x);
			};
		}
		if(!Number.isFinite) {
			Number.isFinite = isFinite;
		}
		if(!Number.isInteger) {
			Number.isInteger = function(x) {
				// @ts-ignore
				return isFinite(x) &amp;&amp; Math.trunc(x) === x;
			};
		}
		if(!Number.isNaN) {
			Number.isNaN = isNaN;
		}
		if(!Number.NaN) {
			// @ts-ignore
			// eslint-disable-next-line no-global-assign
			Number.NaN = NaN;
		}
		if(!Number.EPSILON) {
			// @ts-ignore
			// eslint-disable-next-line no-global-assign
			Number.EPSILON = 2.220446049250313e-16;
		}
		if(!Number.MIN_SAFE_INTEGER) {
			// @ts-ignore
			// eslint-disable-next-line no-global-assign
			Number.MIN_SAFE_INTEGER = -9007199254740991;
		}
		if(!Number.MAX_SAFE_INTEGER) {
			// @ts-ignore
			// eslint-disable-next-line no-global-assign
			Number.MAX_SAFE_INTEGER = 9007199254740991;
		}
		if(!Number.parseFloat) {
			Number.parseFloat = parseFloat;
		}
		if(!Number.parseInt) {
			Number.parseInt = parseInt;
		}
		if(!Number.isSafeInteger) {
			// @ts-ignore
			Number.isSafeInteger = function(x) {
				// @ts-ignore
				return Number.isInteger(x) &amp;&amp; Math.abs(x) &lt;= Number.MAX_SAFE_INTEGER;
			};
		}
		if(!Array.isArray) {
			// @ts-ignore
			Array.isArray = function(x) {
				return Object.prototype.toString.call(x) === &quot;[object Array]&quot;;
			};
		}
		if(!Array.of) {
			// @ts-ignore
			Array.of = function() {
				return Array.prototype.slice.call(arguments);
			};
		}
		if(!String.fromCodePoint) {
			/**
			 * &#x30B3;&#x30FC;&#x30C9;&#x30DD;&#x30A4;&#x30F3;&#x30C8;&#x306E;&#x6570;&#x5024;&#x30C7;&#x30FC;&#x30BF;&#x3092;UTF16&#x306E;&#x914D;&#x5217;&#x306B;&#x5909;&#x63DB;
			 * @param {...(number|Array&lt;number&gt;)} codepoint - &#x5909;&#x63DB;&#x3057;&#x305F;&#x3044;UTF-32&#x306E;&#x914D;&#x5217;&#x3001;&#x53C8;&#x306F;&#x30B3;&#x30FC;&#x30C9;&#x30DD;&#x30A4;&#x30F3;&#x30C8;&#x3092;&#x4E26;&#x3079;&#x305F;&#x53EF;&#x5909;&#x5F15;&#x6570;
			 * @returns {Array&lt;number&gt;} &#x5909;&#x63DB;&#x5F8C;&#x306E;&#x30C6;&#x30AD;&#x30B9;&#x30C8;
			 * @private
			 */
			const toUTF16ArrayfromCodePoint = function() {
				/**
				 * @type {Array&lt;number&gt;}
				 * @private
				 */
				const utf16_array = [];
				/**
				 * @type {Array&lt;number&gt;}
				 * @private
				 */
				let codepoint_array = [];
				if(arguments[0].length) {
					codepoint_array = arguments[0];
				}
				else {
					for(let i = 0;i &lt; arguments.length;i++) {
						codepoint_array[i] = arguments[i];
					}
				}
				for(let i = 0;i &lt; codepoint_array.length;i++) {
					const codepoint = codepoint_array[i];
					if(0x10000 &lt;= codepoint) {
						const high = (( codepoint - 0x10000 ) &gt;&gt; 10) + 0xD800;
						const low  = (codepoint &amp; 0x3FF) + 0xDC00;
						utf16_array.push(high);
						utf16_array.push(low);
					}
					else {
						utf16_array.push(codepoint);
					}
				}
				return utf16_array;
			}

			/**
			 * &#x30B3;&#x30FC;&#x30C9;&#x30DD;&#x30A4;&#x30F3;&#x30C8;&#x306E;&#x6570;&#x5024;&#x30C7;&#x30FC;&#x30BF;&#x3092;&#x6587;&#x5B57;&#x5217;&#x306B;&#x5909;&#x63DB;
			 * @param {...(number|Array&lt;number&gt;)} codepoint - &#x5909;&#x63DB;&#x3057;&#x305F;&#x3044;&#x30B3;&#x30FC;&#x30C9;&#x30DD;&#x30A4;&#x30F3;&#x30C8;&#x306E;&#x6570;&#x5024;&#x914D;&#x5217;&#x3001;&#x53C8;&#x306F;&#x6570;&#x5024;&#x3092;&#x4E26;&#x3079;&#x305F;&#x53EF;&#x5909;&#x5F15;&#x6570;
			 * @returns {string} &#x5909;&#x63DB;&#x5F8C;&#x306E;&#x30C6;&#x30AD;&#x30B9;&#x30C8;
			 */
			String.fromCodePoint = function(codepoint) {
				let utf16_array = null;
				if(codepoint instanceof Array) {
					utf16_array = toUTF16ArrayfromCodePoint(codepoint);
				}
				else {
					const codepoint_array = [];
					for(let i = 0;i &lt; arguments.length;i++) {
						codepoint_array[i] = arguments[i];
					}
					utf16_array = toUTF16ArrayfromCodePoint(codepoint_array);
				}
				const text = [];
				for(let i = 0;i &lt; utf16_array.length;i++) {
					text[text.length] = String.fromCharCode(utf16_array[i]);
				}
				return text.join(&quot;&quot;);
			};
		}
		if(!Date.now) {
			// @ts-ignore
			Date.now = function() {
				return (new Date()).getTime();
			};
		}
		if(!JSON.parse) {
			JSON.parse = function(json_text) {
				return eval(&quot;(&quot; + json_text + &quot;)&quot;);
			};
		}
		if(!JSON.stringify) {
			/**
			 * @type {Object&lt;string, string&gt;} 
			 */
			const escapeMap = {
				&quot;\u0022&quot; : &quot;\\\&quot;&quot;,
				&quot;\u005C&quot; : &quot;\\\\&quot;,
				&quot;\u002F&quot; : &quot;\\/&quot;,
				&quot;\u0008&quot; : &quot;\\b&quot;,
				&quot;\u000C&quot; : &quot;\\f&quot;,
				&quot;\u000A&quot; : &quot;\\n&quot;,
				&quot;\u000D&quot; : &quot;\\r&quot;,
				&quot;\u0009&quot; : &quot;\\t&quot;
			};
			/**
			 * @param {string} str
			 * @returns {string}
			 */
			const escapeString = function(str) {
				return escapeMap[str];
			};
			/**
			 * https://tools.ietf.org/html/rfc8259
			 * @param {string} str
			 * @returns {string}
			 */
			const escape = function(str) {
				return str.replace(/[\u0022\u005C\u002F\u0008\u000C\u000A\u000D\u0009]/g, escapeString);;
			};
			/**
			 * @param {any} data
			 * @returns {string}
			 */
			const stringify = function(data) {
				const type = Object.prototype.toString.call(data);
				if((type === &quot;[object Number]&quot;) || (type === &quot;[object Boolean]&quot;)) {
					return data.toString();
				}
				else if(type === &quot;[object String]&quot;) {
					return &quot;\&quot;&quot; + escape(data) + &quot;\&quot;&quot;;
				}
				else if(type === &quot;[object Date]&quot;) {
					// JScript &#x306B;&#x306F; toISOString &#x304C;&#x306A;&#x3044;&#x306E;&#x3067;&#x3002;
					return &quot;\&quot;&quot; + data.toGMTString() + &quot;\&quot;&quot;;
				}
				else if(type === &quot;[object Function]&quot;) {
					return &quot;null&quot;;
				}
				else if(type === &quot;[object RegExp]&quot;) {
					return &quot;{}&quot;;
				}
				else if(type === &quot;[object Null]&quot;) {
					return &quot;null&quot;;
				}
				else if(type === &quot;[object Undefined]&quot;) {
					return &quot;undefined&quot;;
				}
				else if(type === &quot;[object Array]&quot;) {
					/**
					 * @type {string[]}
					 */
					let output = [];
					output.push(&quot;[&quot;);
					/**
					 * @type {string[]}
					 */
					let array_data = [];
					for(let i = 0; i &lt; data.length; i++) {
						array_data.push(stringify(data[i]));
					}
					output.push(array_data.join(&quot;,&quot;));
					output.push(&quot;]&quot;);
					return output.join(&quot;&quot;);
				}
				else if(type === &quot;[object Object]&quot;) {
					/**
					 * @type {string[]}
					 */
					let output = [];
					output.push(&quot;{&quot;);
					/**
					 * @type {string[]}
					 */
					let object_data = [];
					for(const key in data) {
						const value = data[key];
						// &#x95A2;&#x6570;&#x306E;&#x5834;&#x5408;&#x306F;&#x7121;&#x8996;&#x3059;&#x308B;
						if(Object.prototype.toString.call(value) === &quot;[object Function]&quot;) {
							continue;
						}
						/**
						 * @type {string[]}
						 */
						const line = [];
						line.push(&quot;\&quot;&quot; + key + &quot;\&quot;&quot;);
						line.push(&quot;:&quot;);
						line.push(stringify(value));
						object_data.push(line.join(&quot;&quot;));
					}
					output.push(object_data.join(&quot;,&quot;));
					output.push(&quot;}&quot;);
					return output.join(&quot;&quot;);
				}
				else {
					return &quot;\&quot;&quot; + escape(data.toString()) + &quot;\&quot;&quot;
				}
			};
			JSON.stringify = stringify;
		}
	}
}

// @ts-ignore
Polyfill.run();

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
